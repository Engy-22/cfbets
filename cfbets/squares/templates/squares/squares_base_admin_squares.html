{% extends "squares_base.html" %}

{% block extra_head %}
{% endblock %}

{% block base_content %}
<div class="container">
    <h1>Admin Squares!</h1>

    <button class='btn btn-success' data-toggle="modal" data-target="#newGameModal">
        New Game</button>

    <div class="container">
        <h3>Active Squares</h3>
        {% if active_squares %}
            <p>These are all the active squares games (i.e. they have assigned
            squares, but have not been marked as "complete" by the admin).</p>

                    <!-- Table -->
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th></th>
                            <th>Team A</th>
                            <th>Team B</th>
                            <th>PPS</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for active_square in active_squares %}
                            <tr class="v-center-square">
                                <th scope="row"><button class="btn btn-primary">Mark</button></th>
                                <td>{{ active_square.team_a }}</td>
                                <td>{{ active_square.team_b }}</td>
                                <td>${{ active_square.price_per_square }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
        {% else %}
            <p>No squares games in progress.</p>
        {% endif %}
    </div>

    <div class="container">
        <h3>Closed Squares</h3>
        {% if closed_squares %}
            <p>These are all the games that have already completed and have
            winners marked.</p>

                <!-- Table -->
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th></th>
                        <th>Team A</th>
                        <th>Team B</th>
                        <th>PPS</th>
                        <th>Shits</th>
                        <th>Q1,Q2,Q3,Q4</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for closed_square in closed_squares %}
                        <tr class="v-center-square">
                            <th scope="row"><button class="btn btn-warning">Undo</button></th>
                            <td>{{ closed_sqaure.team_a }}</td>
                            <td>{{ closed_square.team_b }}</td>
                            <td>${{ closed_square.price_per_square }}</td>

                            {% if closed_square.use_shit_payout %}
                            <td>{{ closed_square.shit_22_user.get_full_name }},
                                {{ closed_square.shit_55_user.get_full_name }},
                                {{ closed_square.shit_99_user.get_full_name }}</td>
                            {% else %}
                            <td>n/a</td>
                            {% endif %}

                            <td>{{ closed_square.q1_winning_user.get_full_name }},
                                {{ closed_square.q2_winning_user.get_full_name }},
                                {{ closed_square.q3_winning_user.get_full_name }},
                                {{ closed_square.q4_winning_user.get_full_name }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>

        {% else %}
            <p>Exactly zero closed squares games. We must just be getting started.</p>
        {% endif %}

    	<p>Let's try to create a sample squares view, because I don't feel like
    	doing anything hard while drinking woodford on a plane.</p>

        <table class="table table-hover">
			  <thead>
				<tr>
				  <th scope="col"></th>
				  <th class="text-center" scope="col">0</th>
				  <th class="text-center" scope="col">1</th>
				  <th class="text-center" scope="col">2</th>
				  <th class="text-center" scope="col">3</th>
				  <th class="text-center" scope="col">4</th>
				  <th class="text-center" scope="col">5</th>
				  <th class="text-center" scope="col">6</th>
				  <th class="text-center" scope="col">7</th>
				  <th class="text-center" scope="col">8</th>
				  <th class="text-center" scope="col">9</th>
				</tr>
			  </thead>
			  <tbody>
				<tr>
				  <th scope="row">0</th>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				</tr>
				<tr>
				  <th scope="row">1</th>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				</tr>
				<tr>
				  <th scope="row">2</th>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td class="warning">Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				</tr>
				<tr>
				  <th scope="row">3</th>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td class="success"><strong>Josh Pelkey</strong></td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				</tr>
				<tr>
				  <th scope="row">4</th>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				</tr>
				<tr>
				  <th scope="row">5</th>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td class="warning">Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				</tr>
				<tr>
				  <th scope="row">6</th>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				</tr>
				<tr>
				  <th scope="row">7</th>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				</tr>
				<tr>
				  <th scope="row">8</th>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				</tr>
				<tr>
				  <th scope="row">9</th>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td>Josh Pelkey</td>
				  <td class="warning">Josh Pelkey</td>
				</tr>
			  </tbody>
			</table>

    </div>

</div>

<!-- New Squares Game form modal -->
<div class="modal fade" id="newGameModal" tabindex="-1" role="dialog" aria-labelledby="newGameModalLabel">
    <div class="modal-dialog" role="document">
    	<div class="modal-content">
    		<div class="modal-header">
    			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    			<h4 class="modal-title" id="NewGame">New Game</h4>
			</div>

			<div class="modal-body">
				{% include "squares/new_game.html" %}
			</div>

			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
				<button type="submit" id="new-game-btn" class="btn btn-primary" form="new-game-form">Add Game</button>
			</div>
        </div>
    </div>
</div>

{% endblock %}

{% block morejs %}
	$('#newGameModal').on('show.bs.modal', function () {
		var d = new Date();
		d.setDate(d.getDate() + 7)
		var curr_date = d.getDate();
		var curr_month = d.getMonth() + 1;
		var curr_year = d.getFullYear();
		$('#id_squares_expiration_date').val(curr_month + "/" + curr_date + "/" + curr_year + " 12:00");
	});

	$('#new-game-form').on('submit', function(event) {
		event.preventDefault();
		});

	$('#new-game-form').one('submit', function(event) {
		event.preventDefault();
		$.ajax({
			type: "POST",
			url: this.action,
			data: $(this).serialize(),
			context: this,
			success: function(data, status) {
            window.location.href = data.url;
			},
			error: function(xhr, status, error) {
				$("#new-game-form").html(xhr.responseText);
			}
		});
		return false;
		});

{% endblock %}
